-- // Advanced Dynamic Weather & Day-Night System
-- // Place in ServerScriptService
-- // Created by Grok (handmade, no copy-paste garbage)

local a = game:GetService("TweenService")
local b = game:GetService("Lighting")
local c = game:GetService("RunService")
local d = game:GetService("Players")

-- Config
local e = 24 * 60 -- 24 minutes real-time = 1 Roblox day
local f = 5 * 60 -- Every 5 minutes possible weather change
local g = true

-- Weather types
local h = {
	Clear = {Name = "Clear", FogEnd = 100000, CloudCover = 0.3},
	Cloudy = {Name = "Cloudy", FogEnd = 5000, CloudCover = 0.8},
	Rain = {Name = "Rain", FogEnd = 1000, CloudCover = 0.95, Particle = "Rain"},
	Snow = {Name = "Snow", FogEnd = 800, CloudCover = 0.9, Particle = "Snow"},
	Fog = {Name = "Fog", FogEnd = 100, CloudCover = 0.7},
	Thunderstorm = {Name = "Thunderstorm", FogEnd = 600, CloudCover = 1, Particle = "HeavyRain", Thunder = true}
}

local i = h.Clear
local j = tick() + f

-- Create particle emitters
local k = Instance.new("Folder")
k.Name = "WeatherParticles"
k.Parent = workspace.Terrain

local l = Instance.new("ParticleEmitter")
l.Texture = "rbxasset://textures/particles/rain.png"
l.Rate = 0
l.Lifetime = NumberRange.new(2, 4)
l.Speed = NumberRange.new(40, 60)
l.VelocitySpread = 10
l.Acceleration = Vector3.new(0, -20, 0)
l.Size = NumberSequence.new(0.1, 0)
l.Transparency = NumberSequence.new(0.3, 1)
l.Parent = k

local m = l:Clone()
m.Texture = "rbxasset://textures/particles/snow.png"
m.Rate = 0
m.Speed = NumberRange.new(5, 15)
m.Acceleration = Vector3.new(0, -5, 0)
m.Size = NumberSequence.new{NumberSequenceKeypoint.new(0,0.3), NumberSequenceKeypoint.new(1,0.8)}
m.Parent = k

-- Thunder sound
local n = Instance.new("Sound")
n.SoundId = "rbxassetid://1847664952"
n.Volume = 0
n.Parent = workspace

-- Lightning flash effect
local function o()
	local p = b:FindFirstChildOfClass("BloomEffect") or Instance.new("BloomEffect", b)
	p.Intensity = 10
	a:Create(p, TweenInfo.new(0.1), {Intensity = 0}):Play()

	n.Volume = 3
	n:Play()
	task.wait(0.3)
	n.Volume = 0
end

-- Set weather function
local function q(weather)
	i = weather

	-- Stop all particles
	l.Rate = 0
	m.Rate = 0

	-- Apply weather
	a:Create(b, TweenInfo.new(20, Enum.EasingStyle.Sine), {
		FogEnd = weather.FogEnd,
		CloudCover = weather.CloudCover
	}):Play()

	if weather.Particle == "Rain" or weather.Particle == "HeavyRain" then
		l.Rate = weather.Particle == "HeavyRain" and 1000 or 400
	elseif weather.Particle == "Snow" then
		m.Rate = 600
	end

	if weather.Thunder and g then
		task.spawn(function()
			while i.Thunder and i.Name == "Thunderstorm" do
				task.wait(math.random(8, 25))
				if i.Name == "Thunderstorm" then
					o()
				end
			end
		end)
	end
end

-- Day-night cycle
local function r()
	local s = tick() % e
	local t = (s / e) * 1440
	local u = math.floor(t / 60)
	local v = math.floor(t % 60)

	b.ClockTime = u + v / 60

	-- Dynamic atmosphere based on time
	local w = b:FindFirstChildOfClass("Atmosphere") or Instance.new("Atmosphere", b)

	if u >= 6 and u < 12 then -- Morning
		a:Create(w, TweenInfo.new(300), {Density = 0.2, Color = Color3.fromRGB(200, 220, 255)}):Play()
	elseif u >= 12 and u < 18 then -- Afternoon
		a:Create(w, TweenInfo.new(300), {Density = 0.15, Color = Color3.fromRGB(255, 240, 200)}):Play()
	elseif u >= 18 and u < 20 then -- Sunset
		a:Create(w, TweenInfo.new(180), {Density = 0.4, Color = Color3.fromRGB(255, 140, 100)}):Play()
	else -- Night
		a:Create(w, TweenInfo.new(300), {Density = 0.6, Color = Color3.fromRGB(20, 20, 50)}):Play()
		b.MoonTextureId = "rbxasset://sky/moon.jpg"
	end
end

-- Random weather chooser (weighted)
local function x()
	local y = {
		h.Clear,
		h.Cloudy,
		h.Rain,
		h.Fog,
	}

	if b.ClockTime > 20 or b.ClockTime < 6 then
		table.insert(y, h.Snow) -- More snow at night
	end
	if math.random() < 0.15 then
		table.insert(y, h.Thunderstorm)
	end

	return y[math.random(1, #y)]
end

-- Main loop
c.Heartbeat:Connect(function()
	r()

	if tick() >= j then
		local z = x()
		if z.Name ~= i.Name then
			q(z)
			-- Announce to players
			for _, player in d:GetPlayers() do
				if player.Character and player.Character:FindFirstChild("Head") then
					local A = player.PlayerGui:FindFirstChild("WeatherGUI")
					if not A then
						A = Instance.new("ScreenGui", player.PlayerGui)
						A.Name = "WeatherGUI"
						local B = Instance.new("TextLabel", A)
						B.Size = UDim2.new(0.4, 0, 0.1, 0)
						B.Position = UDim2.new(0.3, 0, 0.05, 0)
						B.BackgroundTransparency = 0.5
						B.BackgroundColor3 = Color3.new(0,0,0)
						B.TextColor3 = Color3.new(1,1,1)
						B.Font = Enum.Font.GothamBold
						B.TextScaled = true
					end
					local C = player.PlayerGui.WeatherGUI:FindFirstChildOfClass("TextLabel")
					if C then
						C.Text = "Weather changing to: " .. z.Name
						task.delay(5, function() 
							if C and C.Parent then 
								C.Text = ""
							end
						end)
					end
				end
			end
		end
		j = tick() + f + math.random(-60, 120)
	end
end)

-- Initialize
b.TimeOfDay = "12:00:00"
q(h.Clear)
print("Advanced Weather & Day-Night System loaded by Grok!")
